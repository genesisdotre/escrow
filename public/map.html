<!DOCTYPE html>
<html lang="en">
<head>
<title>Kleros Hackathon</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">

<script src="miniature.earth.js"></script>

<style>

	html, body {
		margin: 0;
		padding: 0;
		max-height: 800px;
	}

	#myearth {
		height: calc(100vh);
	}

	.overlay {
		background: rgba(255,255,255,0.7);
		width: 400px;
		height: 200px;
	}
</style>

<script>

start1 = {lat: 51.919438, lng: 19.145136}
stop1 = {lat: 51.5073509, lng: -0.1277583}

start2 = {lat: 40.7127753, lng: -74.0059728}
stop2 = {lat: 51.5073509, lng: -0.1277583}

var myoverlay;

window.addEventListener( "earthjsload", function() {
	
	myearth = new Earth( 'myearth', {
		location: { lat: 20, lng: 10 },
		light: 'none',		
		mapLandColor : '#fff',
		mapSeaColor : '#66d8ff',
		mapBorderColor : '#66d8ff',
		mapBorderWidth : 0.4,
		autoRotate : 1
	} );

	myearth.addEventListener( "ready", function() {
		loadLocations();
	} );

} );

function loadLocations() {
	let flightScale = 1;
	let duration = 1;
	let distance1 = Earth.getDistance( start1, stop1 );

	dashedLine1 = myearth.addLine( {
		locations: [ start1, stop1 ],
		color : "red",
		width: 1.25 * flightScale,
		offsetFlow: flightScale,
		dashed: true,
		dashSize: 0.1 * flightScale,
		dashRatio : 0.5,
		clip: 0,
		alwaysBehind: true
	} );
	
	dashedLine1.animate( 'clip', 1, { duration: 1000 + distance1/10 } );



	let distance2 = Earth.getDistance( start2, stop2 );

	dashedLine2 = myearth.addLine( {
		locations: [ start2, stop2 ],
		color : "red",
		width: 1.25 * flightScale,
		offsetFlow: flightScale,
		dashed: true,
		dashSize: 0.1 * flightScale,
		dashRatio : 0.5,
		clip: 0,
		alwaysBehind: true,
	} );
	
	dashedLine2.animate( 'clip', 1, { duration: 1000 + distance2/10 } );

	// dashedLine2.addEventListener( "click", function() {
	// 	console.log("click");
	// });


	let sprite = myearth.addSprite( {
			location : { lat: (start1.lat + stop1.lat) / 2, lng: (start1.lng + stop1.lng) / 2 },
			offset: 1,
			color: 'red',
			scale: 0.3,
			hotspot: true
	} );

	sprite.addEventListener( "click", function() {

		if (myoverlay ) {
			myoverlay.remove();
			myoverlay = null;
		} else {
			myoverlay = myearth.addOverlay( {
				location: { lat: (start1.lat + stop1.lat) / 2, lng: (start1.lng + stop1.lng) / 2 },
				content : '<div class="overlay"><strong> New York </strong></div>',
				className : 'my-text-overlay',
				depthScale : 0.5
			} );
		}


		myearth.addEventListener( "change", function() {
		
			// if ( ! current_marker || auto_rotate ) return;

			if ( myoverlay && Earth.getAngle( myearth.location, myoverlay.location ) > 45 ) {
				myoverlay.remove();
				myoverlay = null;
			}
			
		} );


	});






	function animateLine() {
		dashedLine1.dashOffset -= 0.001; // animate dashed line
		dashedLine2.dashOffset -= 0.001; // animate dashed line
	}
	
	myearth.addEventListener( "update", animateLine );

}


</script>

</head>

<body>

<div id="myearth"></div>

</body>
</html>